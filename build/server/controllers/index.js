// Generated by CoffeeScript 1.11.1
var CozyInstance, Folder, Konnector, User, async;

async = require('async');

User = require('../models/user');

Konnector = require('../models/konnector');

Folder = require('../models/folder');

CozyInstance = require('../models/cozy_instance');

module.exports.main = function(req, res) {
  return async.series({
    konnectors: Konnector.getKonnectorsToDisplay,
    instance: CozyInstance.first,
    folders: Folder.all,
    user: User.first
  }, function(err, results) {
    var folders, instance, konnectors, locale, user;
    if (err != null) {
      console.log(err);
    }
    konnectors = results.konnectors, instance = results.instance, folders = results.folders, user = results.user;
    locale = (instance != null ? instance.locale : void 0) || 'en';
    return res.render('index', {
      imports: "window.locale = \"" + locale + "\";\nwindow.initKonnectors = " + (JSON.stringify(konnectors)) + ";\nwindow.initFolders = " + (JSON.stringify(folders)) + ";\nwindow.user = " + (JSON.stringify(user)) + ";"
    });
  });
};
